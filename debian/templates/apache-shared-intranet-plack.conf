# Apache configuration settings that are shared for every Koha instance.
# This file contains settings for the Plack configuration of the intranet.
#
# This file should be included from an instance's
# /etc/apache2/site-available file, from within the VirtualHost section
# for the intranet.

# Plack is only available out-of-the-box for Apache 2.4.8+ setups
<IfVersion >= 2.4.8>
    <IfModule mod_proxy_http.c>

        # FIXME: These scripts should be fixed so they
        # don't break under plack/starman
        ProxyPass "/cgi-bin/koha/offline_circ/process_koc.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/background-job-progress.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/batch_record_modification.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/batchMod.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/manage-marc-import.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/stage-marc-import.pl" "!"
        ProxyPass "/cgi-bin/koha/tools/upload-cover-image.pl" "!"

        ProxyPreserveHost On

       # RequestHeader set X-FORWARDED-PROTO "https"

        # Point the intranet site to Plack
        ProxyPass /cgi-bin/koha "unix:/var/run/koha/${instance}/plack.sock|http://localhost/intranet"
        ProxyPassReverse /cgi-bin/koha "unix:/var/run/koha/${instance}/plack.sock|http://localhost/intranet"

        # Point the /api endpoint to Plack
       # ProxyPass /api "unix:/var/run/koha/${instance}/plack.sock|http://localhost/api"
       # ProxyPassReverse /api "unix:/var/run/koha/${instance}/plack.sock|http://localhost/api"

    </IfModule>
</IfVersion>
